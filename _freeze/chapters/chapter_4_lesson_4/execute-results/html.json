{
  "hash": "db17154bde76dbcea72837eeb91e2af9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Fitted AR Models\"\nsubtitle: \"Chapter 4: Lesson 4\"\nformat: \n  html:\n    error: false\n    message: false\n    warning: false\n    embed-resources: true\n    toc: true\n    code-fold: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# Loading R packages\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(tidyverse,\n               tsibble, fable,\n               feasts, tsibbledata,\n               fable.prophet,\n               patchwork,\n               lubridate,\n               rio,\n               ggplot2,\n               kableExtra\n               )\n```\n:::\n\n\n\n## Lesson 4.4 Fitted AR Models\n\n### Simulate an AR(1) Time Series\n\nIn this simulation, we first simulate data from the $AR(1)$ model\n$$\n  x_t = 0.75 ~ x_{t-1} + w_t\n$$\nwhere $w_t$ is a white noise process with variance 1.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nset.seed(123)\nn_rep <- 1000\nalpha1 <- 0.75\n\ndat_ts <- tibble(w = rnorm(n_rep)) |>\n  mutate(\n    index = 1:n(),\n    x = purrr::accumulate2(\n      lag(w), w, \n      \\(acc, nxt, w) alpha1 * acc + w,\n      .init = 0)[-1]) |>\n  tsibble::as_tsibble(index = index)\n\ndat_ts |> \n  autoplot(.vars = x) +\n    labs(\n      x = \"Time\",\n      y = \"Simulated Time Series\",\n      title = \"Simulated Values from an AR(1) Process\"\n    ) +\n    theme_minimal() +\n    theme(\n      plot.title = element_text(hjust = 0.5)\n    )\n```\n\n::: {.cell-output-display}\n![](chapter_4_lesson_4_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\nThe R command `mean(dat_ts$x)` gives the mean of the $x_t$ values as 0.067.\n\n\n### Fit an $AR(1)$ Model with Zero Mean\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Fit the AR(1) model\nfit_ar <- dat_ts |>\n  model(AR(x ~ order(1)))\ntidy(fit_ar)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 6\n  .model           term  estimate std.error statistic   p.value\n  <chr>            <chr>    <dbl>     <dbl>     <dbl>     <dbl>\n1 AR(x ~ order(1)) ar1      0.720    0.0220      32.8 2.07e-160\n```\n\n\n:::\n:::\n\n\n\nThe estimate of the parameter $\\alpha_1$ (i.e. the fitted value of the parameter $\\alpha_1$) is $\\hat \\alpha_1 = 0.72$. \n\nWhen R fits an AR model, the mean of the time series is subtracted from the data before the parameter values are estimated. \nIf R detects that the mean of the time series is not significantly different from zero, it is omitted from the output.\n\nBecause the mean is subtracted from the time series before the parameter values are estimated, R is using the model\n$$\n  z_t = \\alpha_1 ~ z_{t-1} + w_t\n$$\nwhere $z_t = x_t - \\mu$ and $\\mu$ is the mean of the time series.\n\n**Things to do** \n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\nAnswer the following questions with your partner.\n\n-   Use the expression for $z_t$ above to solve for $x_t$ in terms of $x_{t-1}$, $\\mu$, $\\alpha_1$, and $w_t$.\n-   What does your model reduce to when $\\mu = 0$?\n-   Explain to your partner why this correctly models a time series with mean $\\mu$.\n:::\n\n\n**WHat do I know**\n\n- For what type of Time Series will a fitted AR model be use?\n- Is the sample above a stationary or non-stationary time series?\n- Stochastic vs deterministic time series?\n- What does this model tell us about the time series?\n\nWe replace the parameter $\\mu$ with its estimator $\\hat \\mu = \\bar x$. We also replace $\\alpha_1$ with the fitted value from the output $\\hat \\alpha_1$. This gives us the fitted model:\n$$\n  \\hat x_t = \\bar x + \\hat \\alpha_1 ~ (x_{t-1} - \\bar x)\n$$\n\nThe fitted model can be expressed as:\n\n\\begin{align*}\n  \\hat x_t \n    &= 0.067 + 0.72 \\left( x_{t-1} - 0.067 \\right) \\\\\n    &= 0.067 - 0.72 ~ (0.067) + 0.72 ~ \\left( x_{t-1} \\right) \\\\\n    &= 0.019 + 0.72 ~ x_{t-1} \n\\end{align*}\n\nEven though R does not report the parameter for the mean of the process, $\\hat \\mu = 0.019$, it is not significantly different from zero. One could argue that we should not use a model that contains the mean and instead focus on a simple fitted model that has only one parameter:\n\n$$\n  \\hat x_t = 0.72 ~ x_{t-1}\n$$\n\n### Confidence Interval for the Model Parameter\n\nThe P-value given above tests the hypothesis that $\\alpha_1=0$. This is not helpful in this context. We are interested in the plausible values for $\\alpha_1$, not whether or not it is different from zero. For this reason, we consider a confidence interval and disregard the P-value.\n\nWe can compute an approximate 95% confidence interval for $\\alpha_1$ as:\n$$\n  \\left( \n    \\hat \\alpha_1 - 2 \\cdot SE_{\\hat \\alpha_1}\n    , ~ \n    \\hat \\alpha_1 + 2 \\cdot SE_{\\hat \\alpha_1}\n  \\right)\n$$\nwhere $\\hat \\alpha_1$ is our parameter estimate and $SE_{\\hat \\alpha_1}$ is the standard error of the estimate. Both of these values are given in the R output.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nci_summary <- tidy(fit_ar) |>\n    mutate(\n        lower = estimate - 2 * std.error,\n        upper = estimate + 2 * std.error\n    )\n```\n:::\n\n\n\nSo, our 95% confidence interval for $\\alpha_1$ is:\n$$\n  \\left(\n  0.72 - 2 \\cdot 0.022\n  , ~\n  0.72 + 2 \\cdot 0.022\n  \\right)\n$$\nor\n$$\n  \\left(\n  0.676\n  , ~\n  0.764\n  \\right)\n$$\nNote that the confidence interval contains $\\alpha_1 = 0.75$, the value of the parameter we used in our simulation. The process of estimating the parameter worked well. In practice, we will not know the value of $\\alpha_1$, but the confidence interval gives us a reasonable estimate of the value.\n\n\n### Residuals\n\nFor an $AR(1)$ model where the mean of the time series is not statistically significantly different from 0, the residuals are computed as\n\\begin{align*}\n  r_t \n    &= x_t - \\hat x_t \\\\\n    &= x_t - \\left[ 0.72 ~ x_{t-1} \\right] \n\\end{align*}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# had include false, and eval false.\n\n\n# Computing the residuals manually\ndat_ts |>\n  # Zero mean model\n  mutate(resid0 = x - ( (tidy(fit_ar) |> select(estimate) |> pull()) * lag(x) ) ) |>\n  # Non-zero mean model\n  mutate(resid1 = x - (mean(x) + (tidy(fit_ar) |> select(estimate) |> pull()) * (lag(x) - mean(x)) ) )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 1,000 x 5 [1]\n         w index      x resid0  resid1\n     <dbl> <int>  <dbl>  <dbl>   <dbl>\n 1 -0.560      1 -0.560 NA     NA     \n 2 -0.230      2 -0.651 -0.247 -0.266 \n 3  1.56       3  1.07   1.54   1.52  \n 4  0.0705     4  0.874  0.103  0.0842\n 5  0.129      5  0.784  0.156  0.137 \n 6  1.72       6  2.30   1.74   1.72  \n 7  0.461      7  2.19   0.531  0.512 \n 8 -1.27       8  0.376 -1.20  -1.22  \n 9 -0.687      9 -0.405 -0.675 -0.694 \n10 -0.446     10 -0.749 -0.458 -0.477 \n# ℹ 990 more rows\n```\n\n\n:::\n:::\n\n\n\nWe can easily obtain these residual values in R:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nfit_ar |> residuals()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 1,000 x 3 [1]\n# Key:       .model [1]\n   .model           index .resid\n   <chr>            <int>  <dbl>\n 1 AR(x ~ order(1))     1 NA    \n 2 AR(x ~ order(1))     2 -0.247\n 3 AR(x ~ order(1))     3  1.54 \n 4 AR(x ~ order(1))     4  0.103\n 5 AR(x ~ order(1))     5  0.156\n 6 AR(x ~ order(1))     6  1.74 \n 7 AR(x ~ order(1))     7  0.531\n 8 AR(x ~ order(1))     8 -1.20 \n 9 AR(x ~ order(1))     9 -0.675\n10 AR(x ~ order(1))    10 -0.458\n# ℹ 990 more rows\n```\n\n\n:::\n:::\n\n\n\nThe variance of the residuals is $0.982$.\nThis is very close to the actual value used in the simulation: $\\sigma^2 = 1$.\n\n\n\n\n\n<!-- Start of the next section -->\n<!-- These parameters are used in the simulation below -->\n\n<!-- I need to review this section and summarize it here. starts at line 247 in the lesson 4 qmd file -->\n<!-- I'm just going to include a list of what they do, but wont fill much so I make sure to go back and review it -->\n\n### Fitting a Simulated AR(1) Part 1\n\n**Fitting a Simulated AR(1) Model with Non-Zero Mean**\n\n#### Fit an AR(1) Model with Non-Zero Mean\n\n**Same as above?**\nI guess in this one we use R to fit an AR(1) model to the time series data. \n\n#### Confidence Interval for the Model Parameters\n\n- We can compute approximate 95% confidence intervals for $\\alpha_0$ and $\\alpha_1$:\n    - I need to review this\n- Review the two columns\n\n#### Residuals\n\nLooks like this sections is one full that can be summarize in one for fitting a simulated AR(1) model with non-zero mean???\n\n### Repeat Part 1: Class Activity\n\n- This section is a class activity but we just repeat part 1 (above section)\n\n### Fitting a Simulated AR(2) Model\n\nSeems to be same as part 1 above, definetly need to understand what this code is doing before I tried solving it.\n\n#### Fit an AR(2) Model\n\n#### Confidence Interval for the Model Parameters\n\n#### Residuals\n\n- We can compute the residuals in the same manner as we did for the other models.\n\n### Activity: Global Warming\n\n#### Using the PACF to Choose p for an AR(p) Process\n\n- In the previous lesson, we noted that the partial correlogram can be used to assess the number of parameters in an AR model. Here is a partial correlogram for the change in the mean annual global temperature.\n\n#### Fitting Models (Dynamic Number of Parameters)\n\n#### Stationary of the AR(p) Model\n\n### Forecasting with an AR(p) Model\n\n**Clas Activity: Forecasting with an AR(p) Model**\n\n#### Comparison to results in Section 4.6.3 of the Book\n\n- Class Activity: Comparison to the Results in Section 4.6.3 of the Book (5 min)\n\n\n\n\n\n\n\n### search for words for lesson 4.4\n\nconceive - white noise process - variance - estimate for the parameter for the constant - \n\n\n",
    "supporting": [
      "chapter_4_lesson_4_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}